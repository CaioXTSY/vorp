{% extends "base.html" %}
{% block title %}Nova Disciplina - Admin{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8" data-aos="fade-up">
  <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
    <h1 class="text-2xl font-bold mb-6">Criar Nova Disciplina</h1>
    
    <form method="POST" action="{{ url_for('admin_new_md') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      
      <div class="space-y-6">
        <!-- Campo Período -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2" for="period_name">
            Período
          </label>
          <input
            type="text"
            name="period_name"
            id="period_name"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            placeholder="Ex: Periodo1, 2025.1, etc."
            required
          >
          <p class="mt-1 text-sm text-gray-500">Use um identificador único para o período</p>
        </div>

        <!-- Campo Disciplina -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2" for="discipline">
            Nome da Disciplina
          </label>
          <input
            type="text"
            name="discipline"
            id="discipline"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
            placeholder="Ex: Cálculo III, Física Quântica"
            required
          >
        </div>

        <!-- Editor Markdown -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2" for="content">
            Conteúdo Inicial
          </label>
          <div class="shadow-sm border border-gray-300 rounded-lg overflow-hidden">
            <textarea
              name="content"
              id="content"
              class="hidden" <!-- Escondido para o EasyMDE -->
            ></textarea>
          </div>
        </div>

        <!-- Botões -->
        <div class="flex justify-end gap-4 mt-8">
          <a
            href="{{ url_for('admin_page') }}"
            class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center"
          >
            <i class="fas fa-times mr-2"></i>
            Cancelar
          </a>
          <button
            type="submit"
            class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center"
          >
            <i class="fas fa-save mr-2"></i>
            Criar Disciplina
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Dependências do Editor -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

<style>
  .EasyMDEContainer .CodeMirror {
    min-height: 400px;
    font-family: 'Fira Code', monospace;
    font-size: 14px;
    padding: 1rem;
  }
  
  .editor-toolbar {
    background: #f8fafc !important;
    border-color: #e2e8f0 !important;
    gap: 8px;
    padding: 12px !important;
  }
</style>

<script>
  // Inicialização do Editor Markdown
  const easyMDE = new EasyMDE({
    element: document.getElementById('content'),
    spellChecker: false,
    autoDownloadFontAwesome: false,
    placeholder: "Escreva o conteúdo inicial em Markdown...",
    toolbar: [
      'bold', 'italic', 'heading', '|',
      'code', 'quote', 'unordered-list', 'ordered-list', '|',
      'link', 'image', 'table', '|',
      'preview', 'guide'
    ]
  });

  // Forçar salvamento antes do submit
  document.querySelector('form').addEventListener('submit', () => {
    easyMDE.codemirror.save();
  });
</script>
{% endblock %}