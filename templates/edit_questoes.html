{% extends "base.html" %}
{% block title %}Editar Questões - {{ disc_file|replace('.md','') }}{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">
  Editando Questões de {{ disc_file|replace('.md','') }}
</h1>

<div class="md:flex md:space-x-4">
  <!-- Editor -->
  <div class="md:w-1/2 mb-4 md:mb-0">
    <form
      method="POST"
      action="{{ url_for('edit_questoes', period_name=period_name, disc_file=disc_file) }}"
    >
      <textarea
        name="markdown_content"
        id="markdown_content"
        rows="20"
        class="w-full p-2 border border-gray-300 rounded mb-4 font-mono"
      >{{ current_content|safe }}</textarea>

      <div class="flex space-x-4">
        <button
          type="submit"
          class="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-700 transition"
        >
          Salvar
        </button>
        <a
          href="{{ url_for('view_questoes', period_name=period_name, disc_file=disc_file) }}"
          class="px-6 py-2 bg-gray-100 rounded-full hover:bg-gray-200 transition"
        >
          Cancelar
        </a>
      </div>
    </form>
  </div>

  <!-- Preview -->
  <div class="md:w-1/2 bg-white p-4 border border-gray-200 rounded overflow-auto">
    <h2 class="text-xl font-bold mb-2">Preview</h2>
    <div id="preview" class="prose max-w-none"></div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const textarea = document.getElementById('markdown_content');
  const previewDiv = document.getElementById('preview');

  function updatePreview() {
    const rawMarkdown = textarea.value;
    let html = marked.parse(rawMarkdown);
    previewDiv.innerHTML = html;
    if (typeof Prism !== 'undefined') {
      Prism.highlightAllUnder(previewDiv);
    }
  }

  updatePreview(); // render inicial
  textarea.addEventListener('input', updatePreview);
});
</script>
{% endblock %}
