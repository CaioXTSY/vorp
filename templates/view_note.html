{% extends "base.html" %}
{% block title %}{{ note.title }} - CAIOBOOK{% endblock %}

{% block content %}
<!-- HERO SECTION MODERNIZADO -->
<section class="relative bg-gradient-to-r from-indigo-500 to-purple-600 text-white pt-24 pb-32 rounded-b-[2.5rem] shadow-2xl overflow-hidden"
         data-aos="fade-up">
  <!-- Efeito de partículas -->
  <div class="absolute inset-0 opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMiIgaGVpZ2h0PSIyIiBmaWxsPSIjZmZmIi8+PC9zdmc+')]"></div>

  <!-- Onda dinâmica -->
  <div class="absolute -bottom-1 left-0 right-0 h-24 bg-[length:100%_24px] bg-repeat-x" 
       style="background-image: url('data:image/svg+xml;utf8,<svg viewBox=\'0 0 120 24\' fill=\'white\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'M0 24V0s19.6 5.434 60 5.434S120 0 120 0v24z\'/></svg>')"></div>

  <div class="container mx-auto px-6 relative z-10">
    <div class="max-w-4xl mx-auto text-center">
      <!-- Cabeçalho com ícone animado -->
      <div class="flex flex-col items-center mb-8">
        <div class="w-20 h-20 mb-6 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center 
                    shadow-lg animate-pulse-slow">
          <i class="fa fa-book-open text-3xl text-white"></i>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-white to-purple-200 bg-clip-text text-transparent">
          {{ note.title }}
        </h1>
        <div class="flex items-center space-x-3 text-indigo-100">
          <div class="flex items-center">
            <i class="fas fa-user-circle mr-2"></i>
            <a href="{{ url_for('profile', username=note.user.username) }}" 
               class="hover:text-white transition-colors font-medium">
              {{ note.user.username }}
            </a>
          </div>
          <span class="opacity-50">•</span>
          <span class="text-sm">{{ note.updated_at|datetime_format }}</span>
        </div>
      </div>

      <!-- Botões de ação com efeito flutuante -->
      <div class="mt-8 flex flex-wrap justify-center gap-4">
        {% if is_logged_in() and note.user_id == session['user_id'] %}
          <a href="{{ url_for('edit_note', note_id=note.id) }}" 
             class="action-btn bg-white text-indigo-600 hover:bg-gray-50 hover:shadow-lg">
            <i class="fas fa-pen-to-square mr-2"></i>Editar
          </a>
        {% endif %}
        <a href="{{ url_for('export_note', note_id=note.id) }}" 
           class="action-btn bg-white text-indigo-600 hover:bg-gray-50 hover:shadow-lg">
          <i class="fas fa-file-pdf mr-2"></i>Exportar
        </a>
        {% if note.is_public %}
          <button id="share-note-btn" 
                  class="action-btn bg-indigo-100 text-indigo-700 hover:bg-indigo-200">
            <i class="fas fa-share-nodes mr-2"></i>Compartilhar
          </button>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- CONTEÚDO PRINCIPAL COM LAYOUT MODERNO -->
<main class="container mx-auto px-6 py-12 -mt-20 relative z-10">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
    <!-- CONTEÚDO DA NOTA -->
    <article class="lg:col-span-8 bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 md:p-8 border border-white/20">
      <div class="prose max-w-none text-gray-700">
        {{ html_content|safe }}
      </div>
    </article>

    <!-- BARRA LATERAL -->
    <aside class="lg:col-span-4 space-y-8">
      <!-- SUMÁRIO -->
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-white/20 sticky top-6">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-indigo-600">
          <i class="fas fa-list-ol"></i>Sumário
        </h2>
        <div class="prose-sm text-gray-600 max-h-[60vh] overflow-y-auto scrollbar-thin scrollbar-thumb-indigo-200">
          {{ toc|safe }}
        </div>
      </div>

      <!-- CHAT COM IA -->
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-white/20">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center">
            <i class="fas fa-robot text-white text-xl"></i>
          </div>
          <h2 class="text-xl font-bold text-gray-800">Assistente de Estudos</h2>
        </div>
        
        <div id="chat-container" class="chat-container">
          <!-- Mensagens do chat aqui -->
        </div>

        <div class="mt-6 flex gap-3">
          <input type="text" 
                 id="user-question" 
                 class="flex-1 input-field" 
                 placeholder="Faça uma pergunta sobre o conteúdo...">
          <button onclick="askQuestion()" 
                  class="send-btn bg-indigo-600 hover:bg-indigo-700">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- ESTILOS PERSONALIZADOS -->
<style>
  .action-btn {
    @apply inline-flex items-center px-6 py-3 rounded-full transition-all 
           duration-300 transform hover:-translate-y-0.5 shadow-md;
  }

  .chat-container {
    @apply bg-gray-50/50 rounded-xl p-4 h-96 overflow-y-auto scrollbar-thin 
           scrollbar-thumb-indigo-100 space-y-4;
  }

  .input-field {
    @apply w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-400 
           focus:ring-2 focus:ring-indigo-100 transition text-sm;
  }

  .send-btn {
    @apply w-12 h-12 flex items-center justify-center rounded-xl text-white 
           transition-colors duration-200 shadow-md hover:shadow-lg;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  .animate-pulse-slow {
    animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  .prose {
    @apply text-gray-700 leading-relaxed;
  }
  .prose h2 { @apply text-2xl font-bold text-indigo-600 mb-4; }
  .prose h3 { @apply text-xl font-semibold text-gray-800 mb-3; }
  .prose p { @apply mb-4; }
  .prose pre { @apply bg-gray-800 text-gray-100 p-4 rounded-xl mb-4 overflow-x-auto; }
  .prose code { @apply bg-gray-100 text-gray-700 px-2 py-1 rounded; }
</style>

<!-- Scripts permanecem similares com ajustes de animação -->
{% endblock %}