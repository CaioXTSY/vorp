{% extends "base.html" %}
{% block title %}{{ period_name }} - Disciplinas{% endblock %}

{% block content %}
<section class="py-8" data-aos="fade-up">
  <h1 class="text-3xl font-bold mb-6">
    Disciplinas do {{ period_name }}
  </h1>
  {% if disciplines and disciplines|length > 0 %}
    <!-- 
      Grade de cards:
      - 1 coluna no mobile
      - 2 colunas em telas md
      - 3 colunas em telas lg 
    -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for disc_info in disciplines %}
        <div class="bg-white p-6 rounded-lg shadow hover:shadow-xl transition flex flex-col">
          <div class="flex items-center justify-between mb-2">
            <!-- Nome/Link da disciplina -->
            <a
              href="{{ url_for('view_markdown', period_name=period_name, md_file=disc_info.filename) }}"
              class="text-indigo-600 font-semibold text-lg hover:underline"
            >
              {{ disc_info.filename|replace('.md', '') }}
            </a>
            {% if is_logged_in() %}
              <!-- Botão de Favoritar (AJAX se quiser) -->
              <button
                class="favorite-btn px-3 py-1 rounded-md text-sm font-medium
                       {% if disc_info.filename.replace('.md','') in favorites %}
                         bg-yellow-200 text-yellow-800
                       {% else %}
                         bg-gray-100 text-gray-600
                       {% endif %}"
                data-discipline="{{ disc_info.filename|replace('.md','') }}"
              >
                {% if disc_info.filename.replace('.md','') in favorites %}
                  <i class="fa fa-star"></i> 
                {% else %}
                  <i class="fa-regular fa-star"></i>
                {% endif %}
              </button>
            {% endif %}
          </div>

          <!-- Data de atualização -->
          {% if disc_info.updated_at %}
            <p class="text-xs text-gray-500 mb-4">
              Atualizado em {{ disc_info.updated_at.strftime('%d/%m/%Y %H:%M') }}
            </p>
          {% endif %}

          <!-- Conteúdo adicional (Ex.: breve descrição) -->
          <div class="text-gray-700 text-sm flex-1">
            <p>
              Aqui você encontrará um resumo completo sobre <strong>{{ disc_info.filename|replace('.md', '') }}</strong>. 
              Clique para ver o conteúdo detalhado, revisar tópicos e praticar o que aprendeu.
            </p>
          </div>

          <!-- Ações -->
          <div class="mt-4 flex items-center space-x-2">
            <a 
              href="{{ url_for('view_markdown', period_name=period_name, md_file=disc_info.filename) }}"
              class="inline-block bg-indigo-600 text-white px-3 py-1.5 rounded hover:bg-indigo-700 transition text-sm"
            >
              <i class="fa fa-book-open"></i> Abrir
            </a>
            {% if is_logged_in() %}
              <a 
                href="{{ url_for('edit_markdown', period_name=period_name, md_file=disc_info.filename) }}"
                class="inline-block bg-gray-100 text-gray-800 px-3 py-1.5 rounded hover:bg-gray-200 transition text-sm"
              >
                <i class="fa fa-edit"></i> Editar
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-500">Nenhuma disciplina encontrada neste período.</p>
  {% endif %}
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  // Exemplo de AJAX para favoritar
  document.querySelectorAll('.favorite-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      const disc = btn.getAttribute('data-discipline');
      fetch(`/favorite/${disc}`, { method: 'POST' })
        .then(resp => resp.json())
        .then(data => {
          if (data.status === 'added') {
            btn.innerHTML = '<i class="fa fa-star"></i>';
            btn.classList.remove('bg-gray-100','text-gray-600');
            btn.classList.add('bg-yellow-200','text-yellow-800');
          } else if (data.status === 'removed') {
            btn.innerHTML = '<i class="fa-regular fa-star"></i>';
            btn.classList.remove('bg-yellow-200','text-yellow-800');
            btn.classList.add('bg-gray-100','text-gray-600');
          }
        });
    });
  });
</script>
{% endblock %}
